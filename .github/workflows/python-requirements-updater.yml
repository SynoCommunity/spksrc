name: Update Python Requirements Config

on:
  workflow_dispatch:
  schedule:
    - cron: '0 2 * * 1'  # Every Monday at 2 AM UTC
  push:
    paths:
      - 'spk/python*/crossenv/requirements-default.txt'
      - 'spk/python*/src/requirements-*.txt'
      - 'native/python*/src/requirements.txt'
      - '.github/actions/update_python_requirements.py'
      - '.github/workflows/python-requirements-updater.yml'

jobs:
  update-config:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install PyYAML
      
      - name: Generate dependabot configuration
        run: |
          python .github/actions/update_python_requirements.py
      
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: "chore: update dependabot config for Python requirements"
          branch: auto/python-requirements-config
          title: "chore: Update Python requirements configuration"
          body: |
            ## Python Requirements Configuration Update
            
            This PR updates the `.github/dependabot.yml` configuration file based on the current Python requirements files in the repository.
            
            ### Scanned Patterns
            - `spk/python*/crossenv/requirements-default.txt`
            - `spk/python*/src/requirements-*.txt`
            - `native/python*/src/requirements.txt`
            
            ### Configuration
            - **Schedule**: Weekly updates
            - **Grouping**: All Python dependencies grouped together per package
            - **Ignored packages**: pip, Cython, msgpack
            
            ---
            *Auto-generated by [update_python_requirements.py](.github/actions/update_python_requirements.py)*
