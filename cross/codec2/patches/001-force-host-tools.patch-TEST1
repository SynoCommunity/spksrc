--- src/CMakeLists.txt-orig	2023-07-19 23:29:48.000000000 +0000
+++ src/CMakeLists.txt	2025-09-29 20:55:28.742068176 +0000
@@ -63,22 +63,37 @@ set(CODEBOOKSNEWAMP2_ENERGY
 
 # when crosscompiling we need a native executable
 if(CMAKE_CROSSCOMPILING)
-    set(CMAKE_DISABLE_SOURCE_CHANGES OFF)
-    include(ExternalProject)
-    ExternalProject_Add(codec2_native
-       SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/..
-       BINARY_DIR ${CMAKE_CURRENT_BINARY_DIR}/codec2_native
-       BUILD_COMMAND ${CMAKE_COMMAND} --build . --target generate_codebook
-       INSTALL_COMMAND ${CMAKE_COMMAND} -E copy ${CMAKE_CURRENT_BINARY_DIR}/codec2_native/src/generate_codebook ${CMAKE_CURRENT_BINARY_DIR}
-       BUILD_BYPRODUCTS ${CMAKE_CURRENT_BINARY_DIR}/generate_codebook
+    # Use native tools for build machine
+    find_program(CMAKE_C_COMPILER_FOR_BUILD NAMES gcc cc clang REQUIRED)
+    
+    # Create a native build directory
+    set(NATIVE_BUILD_DIR ${CMAKE_CURRENT_BINARY_DIR}/native_build)
+    file(MAKE_DIRECTORY ${NATIVE_BUILD_DIR})
+    
+    # Build native generate_codebook using host compiler
+    add_custom_command(
+        OUTPUT ${NATIVE_BUILD_DIR}/generate_codebook
+        COMMAND ${CMAKE_C_COMPILER_FOR_BUILD} 
+                ${CMAKE_CURRENT_SOURCE_DIR}/generate_codebook.c 
+                -o ${NATIVE_BUILD_DIR}/generate_codebook 
+                -lm
+        DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/generate_codebook.c
+        COMMENT "Building native generate_codebook for build machine"
     )
+    
+    add_custom_target(generate_codebook_native ALL
+        DEPENDS ${NATIVE_BUILD_DIR}/generate_codebook
+    )
+    
+    # Create an imported executable that points to the native binary
     add_executable(generate_codebook IMPORTED)
     set_target_properties(generate_codebook PROPERTIES
-        IMPORTED_LOCATION ${CMAKE_CURRENT_BINARY_DIR}/generate_codebook)
-    add_dependencies(generate_codebook codec2_native)
-    set(CMAKE_DISABLE_SOURCE_CHANGES ON)
+        IMPORTED_LOCATION ${NATIVE_BUILD_DIR}/generate_codebook
+    )
+    add_dependencies(generate_codebook generate_codebook_native)
+    
 else(CMAKE_CROSSCOMPILING)
-# Build code generator binaries. These do not get installed.
+    # Build code generator binaries. These do not get installed.
     # generate_codebook
     add_executable(generate_codebook generate_codebook.c)
     target_link_libraries(generate_codebook m)
