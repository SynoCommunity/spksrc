#!/bin/sh

set -e

# ownCloud service setup
WEB_DIR="/var/services/web_packages"
# for backwards compatability
if [ $SYNOPKG_DSM_VERSION_MAJOR -lt 7 ];then
    WEB_DIR="/var/services/web"
fi
OWNCLOUD="${WEB_DIR}/${SYNOPKG_PKGNAME}/occ background:cron"
HOME_DIR="${SYNOPKG_PKGVAR}"
PHP="/usr/local/bin/php74"
SLEEP_TIME="1800"

# Main loop
while true; do
    # Update
    echo "Updating..."
    ${PHP} ${OWNCLOUD} >> "${SYNOPKG_PKGVAR}/daemon.log" 2>&1

    # Wait
    echo "Waiting ${SLEEP_TIME} seconds..."
    sleep ${SLEEP_TIME}
done
