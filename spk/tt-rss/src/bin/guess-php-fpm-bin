#!/bin/bash

profile_name="$1"

SCRIPT_DIR=$(cd $(dirname "${BASH_SOURCE[0]}") && pwd)
source "${SCRIPT_DIR}/settings.sh"

LOG_FILE=${LOGS_DIR}/guess-php-fpm-bin-errors.log
if [ ! -f "${LOG_FILE}" ]
then
    touch "${LOG_FILE}"
    chown http:http "${LOG_FILE}"
    chmod 770 "${LOG_FILE}"
fi

profile_path="${WEB_STATION_HOME_DIR}/etc/php_profile/${profile_name}"
fpm_configuration_file="${profile_path}/fpm.conf"

if [ -f "${fpm_configuration_file}" ]
then
    php_fpm=$(php -r 'print(parse_ini_file($argv[1], true)["global"]["syslog.ident"]);' "${fpm_configuration_file}" 2>>"${LOG_FILE}")
    if [ $? -ne 0 ]
    then
        echo "Failed computing php fpm path." >>"${LOG_FILE}"
        exit 1
    fi
else
    echo "No fpm configuration file can be found under ${fpm_configuration_file}" >>"${LOG_FILE}"
    exit 1
fi

echo -n "${php_fpm}"

